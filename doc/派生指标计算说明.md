# 派生指标计算说明

```sql
SELECT
    account_no_in AS account_no, //account_no_in维度字段, account_no绑定维度
	SUM(amount) AS sum_amount //SUM聚合逻辑, amount就是原子指标的度量值, sum_amount指标名称
FROM 
	trade_detail  //trade_detail 数据明细宽表
WHERE
	amount > 1 //原子指标的前置过滤条件
AND
	trans_timestamp in ('2022-02-03 00:00:00', '2022-02-03 23:59:59') 
				//基于时间字段(trans_timestamp)和时间聚合粒度(DAY和1)得到时间区间
GROUP BY 
	account_no //分组字段
```

### 聚合函数说明

聚合函数分为三类：数值型、对象型和集合型

|        | 输入数据                               | 输入数据          | 说明 |
| :----- | -------------------------------------- | ----------------- | ---- |
| 数值型 | 数值型                                 | 数值              |      |
| 对象型 | 比较字段、保留字段和原始数据           | 对象（JSON对象）  |      |
| 集合型 | 比较字段、排序字段、保留字段和原始数据 | 集合（List和Set） |      |

数值型

输入的数据是数值型，且输出的数据也是数值型

- 最大值(MAX): 计算指定数据集的最大值，如过去24小时最大交易金额; √
- 最小值(MIN): 计算指定数据集的最小值，如过去 24 小时最小交易金额: √
- 求和(SUM): 对指定数据集的对象进行累加，如金额求和; √
- 计数(COUNT): 对指定数据集的记录条数进行计算，如交易次数: √
- 平均值(AVG): 对指定数据集计算单笔平均值; √
- 递增(INCREASECOUNT): 同一账号过去30天的交易序列中出现的递增次数; √
- 递减(DECREASECOUNT): 同一账号过去30天的交易序列中出现的递减次数; √
- 最大连续递增(MAXINCREASECOUNT): 同一账号过去30天的交易序列中出现的最大连续递增次数; √
- 最大连续递减(MAXDECREASECOUNT): 同一账号过去30天的交易序列中出现的最大连续递减次数; √
- 最大连续次数(MAXCONTINUOUSCOUNT): 交易金额最大连续次数; √
- 方差(VARS): 同一账号过去30天的交易方差值; √
- 标准差(VARP): 同一账号过去30天的交易标准差; √
- 协方差(COV): 同一账号过去30天交易频率和交易金额的协方差; √
- 峰度系数: 用于衡量一组数据的尖峭程度，例如账户交易在某一日突增即可用峰度系数来剥量;
- 三阶中心炬: 同一账号过去30天的交易三阶中心矩值;
- 四阶中心炬: 同一账号过去30天的交易四阶中心矩值;

对象型

输入

- 上一笔: 获得上一条数据记录的某个维度，如上一笔交易金额 √
- 最大对象(MAXOBJECT): 同一账号过去30天的最大值交易明细(指定比较字段, 存储原始明细) √
- 最大字段(MAXFIELD): 同一账号过去30天的交易最大金额的时间(指定比较字段, 存储指定字段) √
- 最小对象(MINOBJECT): 同一账号过去30天的最小值交易明细(指定比较字段, 存储原始明细) √
- 最小字段(MINFIELD): 同一账号过去30天的交易最小金额的时间(指定比较字段, 存储指定字段) √
- 占位对象(OCCUPIEDOBJECT): 同一账号过去30天的首次交易明细(存储明细数据) √
- 占位字段(OCCUPIEDFIELD): 同一账号过去30天的首次交易日期(存储指定字段) √
- 取代对象(REPLACEDOBJECT): 同一账号过去30天的最近一次交易明细(存储明细数据) √
- 取代字段(REPLACEDFIELD): 同一账号过去30天的最近一次交易日期(存储指定字段) √

集合型

- 对象列表(LISTOBJECT): 同一账号过去30天的交易明细列表(存储原始明细) √
- 字段列表(LISTFIELD): 同一账号过去30天的交易金额列表(存储指定字段) √
- 去重对象列表(DISTINCTLISTOBJECT): 同一账号过去30天的去重交易明细列表(按照指定字段去重, 存储原始细) √
- 去重字段列表(DISTINCTLISTFIELD): 同一账号过去30天的去重交易地点列表(按照指定字段去重, 存储指定段) √
- 对象排序列表(SORTEDLISTOBJECT): 同一账号过去30天的交易明细列表(按照指定字段排序，存储原始明细) √
- 字段排序列表(SORTEDLISTFIELD): 同一账号过去30天的交易金额列表(按照指定字段排序，存储指定字段) √
- 去重计数(DISTINCTCOUNT): 在计数的基础上，按照指定字段进行去重 √